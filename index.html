<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Royal Keno KZ</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root{--gold:#D4AF37;--gold2:#F5D060;--gold3:#8B6914;--em:#00C878;--em2:#00FF9A;--ruby:#E63950;--obs:#050508;--d1:#0C0C12;--d2:#121218;--d3:#1A1A24;--bdr:rgba(212,175,55,0.15);--bdr2:rgba(212,175,55,0.35);--txt:#EEE8D5;--mut:#5A5470;}
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent;user-select:none;}
html,body{height:100%;overflow:hidden;background:var(--obs);}
body{color:var(--txt);font-family:'Montserrat',sans-serif;font-size:14px;}
#bg-canvas{position:fixed;inset:0;z-index:0;pointer-events:none;}
.app{position:relative;z-index:1;display:flex;flex-direction:column;height:100vh;height:100dvh;overflow:hidden;}
.hdr{flex-shrink:0;background:linear-gradient(180deg,rgba(12,12,18,.98),rgba(12,12,18,.92));border-bottom:1px solid var(--bdr2);padding:10px 14px;display:flex;align-items:center;justify-content:space-between;position:relative;}
.hdr::after{content:'';position:absolute;bottom:-1px;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,var(--gold),transparent);}
.logo{font-family:'Cinzel',serif;font-size:14px;font-weight:900;letter-spacing:3px;background:linear-gradient(135deg,var(--gold3),var(--gold2),var(--gold));-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
.bal-pill{display:flex;align-items:center;gap:5px;background:rgba(212,175,55,.06);border:1px solid var(--bdr2);padding:5px 12px;border-radius:24px;cursor:pointer;}
.bal-pill .amt{font-family:'Cinzel',serif;font-size:13px;font-weight:700;color:var(--gold2);}
.subnav{flex-shrink:0;display:flex;background:var(--d1);border-bottom:1px solid var(--bdr);overflow-x:auto;scrollbar-width:none;}
.subnav::-webkit-scrollbar{display:none;}
.snv{flex:0 0 auto;padding:9px 12px;background:none;border:none;color:var(--mut);font-family:'Montserrat',sans-serif;font-size:10px;font-weight:700;cursor:pointer;transition:all .25s;white-space:nowrap;letter-spacing:1.5px;text-transform:uppercase;position:relative;}
.snv::after{content:'';position:absolute;bottom:0;left:50%;right:50%;height:2px;background:linear-gradient(90deg,var(--gold3),var(--gold2));transition:all .3s cubic-bezier(.34,1.56,.64,1);}
.snv.on{color:var(--gold2);}.snv.on::after{left:6px;right:6px;}
.scr{flex:1;overflow-y:auto;overflow-x:hidden;padding:14px 13px 16px;scrollbar-width:thin;scrollbar-color:var(--gold3) transparent;}
.scr::-webkit-scrollbar{width:3px;}.scr::-webkit-scrollbar-thumb{background:var(--gold3);}
.card{background:linear-gradient(135deg,rgba(26,26,36,.95),rgba(18,18,24,.95));border:1px solid var(--bdr);border-radius:14px;padding:15px;margin-bottom:11px;position:relative;overflow:hidden;}
.card::before{content:'';position:absolute;top:0;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,rgba(212,175,55,.4),transparent);}
.ctit{font-family:'Cinzel',serif;font-size:10px;font-weight:700;color:var(--gold);letter-spacing:3px;text-transform:uppercase;margin-bottom:13px;}
.btn{display:inline-flex;align-items:center;justify-content:center;gap:6px;width:100%;padding:12px 18px;border:none;border-radius:10px;font-family:'Montserrat',sans-serif;font-size:13px;font-weight:700;cursor:pointer;letter-spacing:1.5px;text-transform:uppercase;transition:all .15s;margin-bottom:8px;}
.btn:active{transform:scale(.97);}.btn:disabled{opacity:.35;cursor:not-allowed;transform:none;}
.btn-gold{background:linear-gradient(135deg,#8B6914,#D4AF37,#F5D060);color:#1a1200;box-shadow:0 4px 20px rgba(212,175,55,.3);}
.btn-em{background:linear-gradient(135deg,#006640,#00C878);color:#001a0d;}
.btn-ghost{background:transparent;border:1px solid var(--bdr2);color:var(--gold);}
.g2{display:grid;grid-template-columns:1fr 1fr;gap:8px;}
.g3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:6px;}
.fld{margin-bottom:11px;}
.flbl{font-size:10px;letter-spacing:2px;text-transform:uppercase;color:var(--mut);margin-bottom:5px;font-weight:700;}
.inp{width:100%;background:rgba(5,5,8,.8);border:1px solid var(--bdr);border-radius:8px;padding:10px 13px;color:var(--txt);font-family:'Montserrat',sans-serif;font-size:15px;font-weight:600;outline:none;transition:border-color .2s;-webkit-appearance:none;}
.inp:focus{border-color:var(--gold);}.inp::placeholder{color:var(--mut);}
.pres{display:flex;gap:5px;flex-wrap:wrap;margin-bottom:11px;}
.pre{padding:5px 9px;background:rgba(212,175,55,.05);border:1px solid var(--bdr);border-radius:6px;color:var(--mut);font-size:11px;font-weight:700;cursor:pointer;transition:all .15s;}
.pre.on,.pre:active{border-color:var(--gold);color:var(--gold);background:rgba(212,175,55,.1);}
.res{border-radius:12px;padding:16px;text-align:center;margin-top:13px;animation:rPop .4s cubic-bezier(.34,1.56,.64,1);}
.rw{background:rgba(0,200,120,.08);border:1px solid rgba(0,200,120,.25);}
.rl{background:rgba(230,57,80,.08);border:1px solid rgba(230,57,80,.2);}
.rt{background:rgba(212,175,55,.08);border:1px solid rgba(212,175,55,.2);}
.rbig{font-family:'Cinzel',serif;font-size:24px;font-weight:900;}
.rw .rbig{color:var(--em2);}.rl .rbig{color:var(--ruby);}.rt .rbig{color:var(--gold2);}
.rsub{font-size:10px;color:var(--mut);margin-top:4px;letter-spacing:2px;text-transform:uppercase;}
.sl{display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid var(--bdr);}
.sl:last-child{border:none;}.sk{color:var(--mut);font-size:12px;}.sv{font-weight:700;font-size:13px;font-family:'Cinzel',serif;}
.spinner{width:18px;height:18px;border:2px solid var(--bdr);border-top-color:var(--gold);border-radius:50%;animation:spin .6s linear infinite;display:inline-block;}
.loading{display:flex;align-items:center;justify-content:center;gap:8px;padding:30px;color:var(--mut);}
.toast{position:fixed;bottom:74px;left:50%;transform:translateX(-50%);background:rgba(18,18,24,.97);border:1px solid var(--bdr2);border-radius:10px;padding:9px 18px;font-size:13px;font-weight:600;color:var(--txt);z-index:9999;white-space:nowrap;animation:slideUp .3s ease;}
.particle{position:fixed;pointer-events:none;z-index:9998;font-size:20px;animation:pFly 1.2s ease forwards;}
/* welcome */
.welcome{display:flex;flex-direction:column;align-items:center;padding:20px 4px;}
.wlogo{font-family:'Cinzel',serif;font-size:26px;font-weight:900;background:linear-gradient(135deg,var(--gold3),var(--gold2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:6px;animation:float 3s ease infinite;}
.perk{display:flex;align-items:center;gap:10px;padding:9px 13px;background:rgba(212,175,55,.04);border:1px solid var(--bdr);border-radius:10px;margin-bottom:7px;}
/* profile */
.avatar{width:68px;height:68px;border-radius:50%;background:linear-gradient(135deg,var(--gold3),var(--gold2));display:flex;align-items:center;justify-content:center;margin:0 auto 10px;font-size:30px;animation:glow 2s ease infinite;}
.vip-b{display:inline-flex;align-items:center;gap:5px;background:linear-gradient(135deg,var(--gold3),var(--gold));color:#1a1000;padding:3px 11px;border-radius:20px;font-family:'Cinzel',serif;font-size:11px;font-weight:700;letter-spacing:2px;}
/* history */
.hrow{display:flex;align-items:center;gap:8px;padding:9px 0;border-bottom:1px solid var(--bdr);}
.hrow:last-child{border:none;}.hico{width:32px;height:32px;border-radius:8px;background:var(--d3);display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0;}
.hinfo{flex:1;}.hgame{font-size:12px;font-weight:700;}.hdate{font-size:10px;color:var(--mut);}
.hamt{font-family:'Cinzel',serif;font-size:13px;font-weight:700;}.hamt.w{color:var(--em2);}.hamt.l{color:var(--ruby);}
/* top */
.trow{display:flex;align-items:center;gap:10px;padding:9px 0;border-bottom:1px solid var(--bdr);}
.trow:last-child{border:none;}.trank{font-family:'Cinzel',serif;font-size:16px;font-weight:900;width:28px;color:var(--mut);}
.trank.g{color:#FFD700;}.trank.s{color:#C0C0C0;}.trank.b{color:#CD7F32;}
.tname{flex:1;font-weight:700;}.tbal{color:var(--gold);font-weight:700;font-family:'Cinzel',serif;}
/* ref */
.ref-link{background:var(--obs);border:1px solid var(--bdr2);border-radius:8px;padding:10px 13px;font-size:11px;color:var(--gold2);word-break:break-all;margin-bottom:10px;cursor:pointer;}
.rss{flex:1;text-align:center;padding:12px;background:rgba(212,175,55,.04);border:1px solid var(--bdr);border-radius:10px;}
.rssv{font-family:'Cinzel',serif;font-size:22px;font-weight:700;color:var(--gold2);}
.rssl{font-size:10px;color:var(--mut);text-transform:uppercase;letter-spacing:1px;margin-top:3px;}
/* demo badge */
.demo-badge{display:inline-flex;align-items:center;gap:5px;background:rgba(230,57,80,.1);border:1px solid rgba(230,57,80,.3);padding:4px 10px;border-radius:20px;font-size:11px;color:var(--ruby);margin-bottom:10px;font-weight:700;}
/* games */
.arena{background:radial-gradient(ellipse at 50% 100%,rgba(0,200,120,.06),transparent),linear-gradient(180deg,var(--d1),var(--obs));border:1px solid var(--bdr);border-radius:14px;height:185px;display:flex;flex-direction:column;align-items:center;justify-content:center;margin-bottom:13px;position:relative;overflow:hidden;}
.arena canvas{position:absolute;inset:0;width:100%;height:100%;}
.cmult{font-family:'Cinzel',serif;font-size:50px;font-weight:900;position:relative;z-index:2;transition:color .3s;}
.cmult.idle{color:var(--gold2);}.cmult.fly{color:var(--em2);animation:rkP .4s ease infinite;}.cmult.boom{color:var(--ruby);animation:shake .4s ease;}
.cst{font-size:10px;letter-spacing:3px;text-transform:uppercase;margin-top:5px;position:relative;z-index:2;}
.cst.idle{color:var(--mut);}.cst.fly{color:var(--em);}.cst.boom{color:var(--ruby);}
.smach{background:linear-gradient(180deg,var(--obs),var(--d1));border:2px solid var(--bdr2);border-radius:16px;padding:14px 10px;margin-bottom:13px;position:relative;}
.smach::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,var(--gold),transparent);}
.reels{display:flex;gap:7px;}.reel{flex:1;height:88px;background:var(--obs);border:1px solid var(--bdr);border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:40px;}
.reel.win{border-color:var(--gold);box-shadow:0 0 20px rgba(212,175,55,.4);animation:glow 1s ease infinite;}
.sline{position:absolute;top:50%;left:0;right:0;height:2px;transform:translateY(-50%);background:linear-gradient(90deg,transparent,rgba(212,175,55,.6),transparent);}
.felt{background:radial-gradient(ellipse at 50% 100%,#0d3320,#071a10);border:2px solid rgba(0,80,30,.6);border-radius:16px;padding:14px;margin-bottom:11px;min-height:195px;position:relative;}
.felt::before{content:'';position:absolute;inset:5px;border:1px solid rgba(0,100,40,.3);border-radius:10px;pointer-events:none;}
.hlbl{font-size:9px;letter-spacing:3px;color:rgba(255,255,255,.3);text-transform:uppercase;margin-bottom:5px;font-family:'Cinzel',serif;}
.hand{display:flex;flex-wrap:nowrap;margin-bottom:5px;min-height:62px;align-items:center;}
.pc{width:42px;height:60px;border-radius:6px;display:flex;flex-direction:column;align-items:flex-start;justify-content:flex-start;padding:3px 4px;font-size:12px;font-weight:900;border:1px solid rgba(0,0,0,.2);box-shadow:2px 3px 8px rgba(0,0,0,.5);flex-shrink:0;margin-right:-8px;animation:cD .25s ease;font-family:'Cinzel',serif;position:relative;}
.pc.wh{background:linear-gradient(135deg,#fff,#f0f0f0);color:#111;}.pc.rd{background:#fff;color:#c0392b;}
.pc.bk{background:linear-gradient(135deg,#1a3a8f,#0d1f5f);align-items:center;justify-content:center;font-size:22px;}
.pcs{font-size:10px;position:absolute;bottom:2px;right:3px;opacity:.7;}
.ws{display:flex;justify-content:center;margin-bottom:15px;}
.wo{width:150px;height:150px;border-radius:50%;background:conic-gradient(#c0392b 0 9.73deg,#111 9.73deg 19.46deg,#c0392b 19.46deg 29.19deg,#111 29.19deg 38.92deg,#c0392b 38.92deg 48.65deg,#111 48.65deg 58.38deg,#c0392b 58.38deg 68.11deg,#111 68.11deg 77.84deg,#c0392b 77.84deg 87.57deg,#2ecc71 87.57deg 97.3deg,#c0392b 97.3deg 107.03deg,#111 107.03deg 116.76deg,#c0392b 116.76deg 126.49deg,#111 126.49deg 136.22deg,#c0392b 136.22deg 145.95deg,#111 145.95deg 155.68deg,#c0392b 155.68deg 165.41deg,#111 165.41deg 175.14deg,#c0392b 175.14deg 184.87deg,#111 184.87deg 194.6deg,#c0392b 194.6deg 204.33deg,#111 204.33deg 214.06deg,#c0392b 214.06deg 223.79deg,#111 223.79deg 233.52deg,#c0392b 233.52deg 243.25deg,#111 243.25deg 252.98deg,#c0392b 252.98deg 262.71deg,#111 262.71deg 272.44deg,#c0392b 272.44deg 282.17deg,#111 282.17deg 291.9deg,#c0392b 291.9deg 301.63deg,#111 301.63deg 311.36deg,#c0392b 311.36deg 321.09deg,#111 321.09deg 330.82deg,#c0392b 330.82deg 340.55deg,#111 340.55deg 350.28deg,#c0392b 350.28deg 360deg);border:3px solid var(--gold);display:flex;align-items:center;justify-content:center;transition:transform 2.5s cubic-bezier(.17,.67,.08,1);}
.wi{width:40px;height:40px;border-radius:50%;background:radial-gradient(circle,var(--d2),var(--obs));border:2px solid var(--gold);display:flex;align-items:center;justify-content:center;font-family:'Cinzel',serif;font-size:12px;font-weight:700;color:var(--gold2);}
.wp{position:absolute;top:-5px;left:50%;transform:translateX(-50%);width:0;height:0;border-left:6px solid transparent;border-right:6px solid transparent;border-top:12px solid var(--gold);}
.bts{display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-bottom:11px;}
.bt{padding:9px 7px;border-radius:8px;border:1px solid var(--bdr);background:rgba(5,5,8,.6);color:var(--mut);font-size:12px;font-weight:700;cursor:pointer;text-align:center;transition:all .2s;}
.bt.on{border-color:var(--gold);background:rgba(212,175,55,.08);color:var(--gold2);}
.kg{display:grid;grid-template-columns:repeat(10,1fr);gap:3px;margin-bottom:11px;}
.kn{aspect-ratio:1;border-radius:5px;background:rgba(5,5,8,.8);border:1px solid rgba(212,175,55,.08);display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:700;cursor:pointer;transition:all .12s;}
.kn:active{transform:scale(.85);}.kn.sel{background:rgba(212,175,55,.15);border-color:var(--gold);color:var(--gold2);}
.kn.drw{background:rgba(0,200,120,.1);border-color:rgba(0,200,120,.4);color:var(--em2);}
.kn.hit{background:rgba(212,175,55,.3);border-color:var(--gold);color:var(--gold2);animation:hitP .5s ease;}
.ksts{display:flex;justify-content:space-between;margin-bottom:9px;}
.ksv{font-family:'Cinzel',serif;font-size:17px;font-weight:700;color:var(--gold2);}
.ksl{font-size:9px;color:var(--mut);letter-spacing:2px;text-transform:uppercase;margin-top:2px;}
/* bottom nav */
.bnav{flex:0 0 auto;display:flex;background:var(--d1);border-top:1px solid var(--bdr);padding:6px 2px;}
.bni{flex:1;background:none;border:none;padding:5px 2px;cursor:pointer;display:flex;flex-direction:column;align-items:center;gap:2px;}
.bni span:first-child{font-size:17px;}.dot{width:4px;height:4px;border-radius:50%;transition:all .2s;}
/* rate badge */
.rbadge{display:inline-flex;align-items:center;gap:4px;background:rgba(212,175,55,.08);border:1px solid var(--bdr2);padding:4px 10px;border-radius:20px;font-size:11px;color:var(--gold2);margin-bottom:12px;}
@keyframes rPop{from{opacity:0;transform:scale(.85) translateY(10px)}to{opacity:1;transform:scale(1) translateY(0)}}
@keyframes glow{0%,100%{box-shadow:0 0 10px rgba(212,175,55,.3)}50%{box-shadow:0 0 30px rgba(212,175,55,.7)}}
@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-6px)}}
@keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-4px)}75%{transform:translateX(4px)}}
@keyframes cD{from{opacity:0;transform:translateX(-15px)}to{opacity:1;transform:none}}
@keyframes rkP{0%,100%{transform:scale(1)}50%{transform:scale(1.08) translateY(-4px)}}
@keyframes hitP{0%{transform:scale(1)}50%{transform:scale(1.3)}100%{transform:scale(1)}}
@keyframes slideUp{from{opacity:0;transform:translate(-50%,20px)}to{opacity:1;transform:translate(-50%,0)}}
@keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}
@keyframes pFly{0%{opacity:1;transform:translateY(0) scale(1)}100%{opacity:0;transform:translateY(-120px) scale(.3) rotate(360deg)}}
</style>
</head>
<body>
<canvas id="bg-canvas"></canvas>
<div id="root"></div>
<!-- –≠–∫—Ä–∞–Ω –æ—à–∏–±–∫–∏ (—Å–∫—Ä—ã—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
<div id="err-screen" style="display:none;position:fixed;inset:0;background:#050508;z-index:99999;display:none;align-items:center;justify-content:center;padding:20px;text-align:center;flex-direction:column;gap:12px;">
  <div style="font-size:36px">‚ö†Ô∏è</div>
  <div style="font-family:monospace;color:#E63950;font-size:13px" id="err-msg">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>
  <button onclick="location.reload()" style="background:#D4AF37;border:none;border-radius:8px;padding:10px 20px;font-weight:700;cursor:pointer;margin-top:8px">üîÑ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å</button>
</div>
<script>
window.onerror = function(msg, src, line, col, err) {
  var s = document.getElementById('err-screen');
  var m = document.getElementById('err-msg');
  if(s && m) { s.style.display='flex'; m.textContent = msg + ' ('+line+':'+col+')'; }
  console.error('Global error:', msg, src, line, col, err);
};
// –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ React –∑–∞–≥—Ä—É–∑–∏–ª—Å—è
window.addEventListener('load', function() {
  if(typeof React === 'undefined' || typeof ReactDOM === 'undefined' || typeof Babel === 'undefined') {
    var s = document.getElementById('err-screen');
    var m = document.getElementById('err-msg');
    if(s && m) { s.style.display='flex'; m.textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.'; }
  }
});
</script>
<script type="text/babel">
const {useState,useEffect,useRef} = React;
const tg = window.Telegram?.WebApp;
const tgUser = tg?.initDataUnsafe?.user;

// ================================================================
// API ‚Äî –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –î–ï–ú–û / –†–ï–ê–õ–¨–ù–´–ô –°–ï–†–í–ï–†
// ================================================================
// –î–ï–ú–û: —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ —Å–µ—Ä–≤–µ—Ä–∞, –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ –±—Ä–∞—É–∑–µ—Ä–∞
// –°–ï–†–í–ï–†: —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π —Å—Ç—Ä–æ–∫—É SERVER_URL –∫–æ–≥–¥–∞ –Ω–∞—Å—Ç—Ä–æ–∏—à—å VPS
// ================================================================
const SERVER_URL = ""; // TODO: –∑–∞–º–µ–Ω–∏ –Ω–∞ "https://—Ç–≤–æ–π-–¥–æ–º–µ–Ω.com" –∫–æ–≥–¥–∞ –±—É–¥–µ—Ç —Å–µ—Ä–≤–µ—Ä
const DEMO_MODE  = !SERVER_URL;

// –î–µ–º–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (–ø–æ–∫–∞ –Ω–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞)
const _demo = {
  registered: false,
  username: "",
  balance: 500,
  vip: 1,
  games: 0, wins: 0, total_bet: 0, total_win: 0,
  history: [],
  last_bonus: null,
  ref_count: 0,
  invoice_pending: null,
  nonce: 0,
  hashed_seed: "demo_seed_hash_not_real",
};

// ‚îÄ‚îÄ –ü—Ä–æ–≤–∞–±–ª–∏ –§—ç–π—Ä —É—Ç–∏–ª–∏—Ç—ã (—Ä–∞–±–æ—Ç–∞—é—Ç –≤ –±—Ä–∞—É–∑–µ—Ä–µ) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const PF = {
  // HMAC-SHA256 —á–µ—Ä–µ–∑ SubtleCrypto API
  async hmac(key, message) {
    const enc = new TextEncoder();
    const k = await crypto.subtle.importKey(
      'raw', enc.encode(key),
      {name:'HMAC', hash:'SHA-256'}, false, ['sign']
    );
    const sig = await crypto.subtle.sign('HMAC', k, enc.encode(message));
    return Array.from(new Uint8Array(sig)).map(b=>b.toString(16).padStart(2,'0')).join('');
  },
  // –ü–æ–ª—É—á–∏—Ç—å float 0-1 –∏–∑ —Ö—ç—à–∞
  async getFloat(serverSeed, clientSeed, nonce) {
    const hash = await this.hmac(clientSeed, `${serverSeed}:${nonce}`);
    const val = parseInt(hash.slice(0,8), 16);
    return val / 0xFFFFFFFF;
  },
  // –ö—Ä–∞—à: –∏–∑ float ‚Üí –º–Ω–æ–∂–∏—Ç–µ–ª—å
  crashPoint(r) {
    if(r < 0.05) return 1.00;
    return Math.min(Math.round((0.95/(1-r))*100)/100, 100);
  },
  // –†—É–ª–µ—Ç–∫–∞: 0-36
  roulette(r) { return Math.floor(r * 37); },
};

async function api(method, body={}, silent=false) {
  // ‚îÄ‚îÄ –î–ï–ú–û –†–ï–ñ–ò–ú (–∞–∫—Ç–∏–≤–µ–Ω –ø–æ–∫–∞ SERVER_URL –ø—É—Å—Ç–æ–π) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  if(DEMO_MODE) {
    await new Promise(r=>setTimeout(r,80));

    if(method==='profile'){
      if(!_demo.registered) return {ok:false};
      return {ok:true, data:{
        username:_demo.username, balance:_demo.balance,
        vip:_demo.vip, games:_demo.games, wins:_demo.wins,
        total_bet:_demo.total_bet, total_win:_demo.total_win,
        hashed_seed:_demo.hashed_seed, nonce:_demo.nonce,
      }};
    }
    if(method==='register'){
      // –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ –≤ –¥–µ–º–æ —Ä–µ–∂–∏–º–µ
      const taken=['admin','royal','keno','bot','system','moderator'];
      if(taken.includes((body.username||'').toLowerCase()))
        return {ok:false, error:'–≠—Ç–æ—Ç –Ω–∏–∫–Ω–µ–π–º –∑–∞–Ω—è—Ç, –≤—ã–±–µ—Ä–∏ –¥—Ä—É–≥–æ–π'};
      _demo.registered=true;
      _demo.username=body.username||'–ò–≥—Ä–æ–∫';
      _demo.balance=500;
      return {ok:true, balance:500};
    }
    if(method==='play'){
      _demo.balance = _demo.balance - body.bet + (body.win||0);
      _demo.games++; if(body.win>body.bet) _demo.wins++;
      _demo.total_bet+=body.bet; _demo.total_win+=(body.win||0);
      const nonce = _demo.nonce++;
      _demo.history.unshift({
        game:body.game, date:new Date().toISOString(),
        bet:body.bet, spot:body.spot||0,
        hits:body.hits||0, win:body.win||0, nonce
      });
      if(_demo.history.length>30) _demo.history.pop();
      return {ok:true, balance:_demo.balance, nonce, hashed_seed:_demo.hashed_seed};
    }
    if(method==='balance') return {ok:true,balance:_demo.balance,vip:_demo.vip,rate:0.013,rate_str:'1 USDT = 76 ‚òÖ  ¬∑  1000 ‚òÖ = $13.00'};
    if(method==='rate')    return {ok:true,rate:0.013,formatted:'1 USDT = 76 ‚òÖ  ¬∑  1000 ‚òÖ = $13.00'};
    if(method==='bonus_status'){
      if(!_demo.last_bonus) return {ok:true,can_claim:true};
      const diff=Date.now()-_demo.last_bonus;
      if(diff>=86400000) return {ok:true,can_claim:true};
      const left=86400000-diff;
      const h=Math.floor(left/3600000),m=Math.floor((left%3600000)/60000);
      return {ok:true,can_claim:false,time_left:`${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}`};
    }
    if(method==='claim_bonus'){
      if(_demo.last_bonus && Date.now()-_demo.last_bonus<86400000) return {ok:false,time_left:'23:59'};
      const bonus=Math.floor(20*(1+(_demo.vip-1)*.2));
      _demo.balance+=bonus; _demo.last_bonus=Date.now();
      return {ok:true,bonus};
    }
    if(method==='cashback_status'){
      const loss=_demo.total_bet-_demo.total_win;
      if(loss>=1000) return {ok:true,available:true,cashback:Math.floor(loss*.05),weekly_loss:loss};
      return {ok:true,available:false,min_loss:1000,current_loss:Math.max(0,loss)};
    }
    if(method==='claim_cashback'){
      const loss=_demo.total_bet-_demo.total_win;
      if(loss<1000) return {ok:false,error:'–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–æ–∏–≥—Ä—ã—à–µ–π'};
      const cb=Math.floor(loss*.05);
      _demo.balance+=cb;
      return {ok:true,cashback:cb,balance:_demo.balance};
    }
    if(method==='seed_info') return {ok:true,
      hashed_server_seed:_demo.hashed_seed,
      client_seed:'demo_client',
      nonce:_demo.nonce};
    if(method==='history') return {ok:true,history:_demo.history};
    if(method==='top')     return {ok:true,top:[{username:_demo.username||'–í—ã',balance:_demo.balance,vip:_demo.vip}]};
    if(method==='referrals') return {ok:true,count:_demo.ref_count};

    // ‚îÄ‚îÄ –î–ï–ú–û –ü–û–ü–û–õ–ù–ï–ù–ò–ï ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    if(method==='create_invoice'){
      const stars=Math.floor(body.amount_usdt/0.013);
      const isFirst=!_demo.had_deposit;
      const bonus_stars=isFirst?stars:0;
      const stars_total=stars+bonus_stars;
      _demo.invoice_pending={id:Date.now(),usdt:body.amount_usdt,stars,bonus_stars,stars_total,is_first:isFirst};
      return {ok:true,invoice_id:_demo.invoice_pending.id,
              pay_url:'https://t.me/CryptoBot',
              amount_usdt:body.amount_usdt,
              stars, bonus_stars, stars_total, is_first:isFirst,
              rate:0.013, rate_str:'1 USDT = 76 ‚òÖ', demo:true};
    }
    if(method==='check_invoice'){
      if(!_demo.invoice_pending) return {ok:false,error:'–°—á—ë—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω'};
      const {stars,stars_total,bonus_stars,is_first}=_demo.invoice_pending;
      _demo.balance+=stars_total||stars;
      if(is_first) _demo.had_deposit=true;
      _demo.invoice_pending=null;
      return {ok:true,paid:true,stars:stars_total||stars,
              bonus_stars:bonus_stars||0,rate_str:'1 USDT = 76 ‚òÖ',demo:true};
    }

    // ‚îÄ‚îÄ –î–ï–ú–û –í–´–í–û–î ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    if(method==='withdraw'){
      if(body.stars>_demo.balance) return {ok:false,error:'–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–∞–ª–∞–Ω—Å–∞'};
      _demo.balance-=body.stars;
      const usdt=parseFloat((body.stars*0.013).toFixed(4));
      return {ok:true,stars:body.stars,usdt,rate_str:'1 USDT = 76 ‚òÖ',demo:true};
    }

    return {ok:true};
  }

  // ‚îÄ‚îÄ –†–ï–ê–õ–¨–ù–´–ô –°–ï–†–í–ï–† ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  // –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π SERVER_URL –≤—ã—à–µ —á—Ç–æ–±—ã –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å
  try{
    console.log('[API]', method, body);
    const r=await fetch(`${SERVER_URL}/api/${method}`,{
      method:"POST",
      headers:{"Content-Type":"application/json","X-Init-Data":tg?.initData||""},
      body:JSON.stringify(body)
    });
    return await r.json();
  }catch(e){
    if(!silent) showToast("‚ö†Ô∏è –ù–µ—Ç —Å–≤—è–∑–∏ —Å —Å–µ—Ä–≤–µ—Ä–æ–º");
    return {ok:false};
  }
}

// ================================================================
// –£–¢–ò–õ–ò–¢–´
// ================================================================
class Snd{
  i(){if(!this.c)this.c=new(window.AudioContext||window.webkitAudioContext)();}
  b(f,d,t='sine',v=.12){if(!this.c)return;const o=this.c.createOscillator(),g=this.c.createGain();o.connect(g);g.connect(this.c.destination);o.type=t;o.frequency.value=f;g.gain.setValueAtTime(v,this.c.currentTime);g.gain.exponentialRampToValueAtTime(.001,this.c.currentTime+d);o.start();o.stop(this.c.currentTime+d);}
  win(){this.b(523,.1);setTimeout(()=>this.b(659,.1),100);setTimeout(()=>this.b(784,.15),200);setTimeout(()=>this.b(1047,.3),300);}
  lose(){this.b(330,.1,'sawtooth');setTimeout(()=>this.b(220,.3,'sawtooth'),100);}
  click(){this.b(800,.05,'square',.05);}
  tick(){this.b(1200,.04,'square',.08);}
  deal(){this.b(600,.08,'triangle',.1);}
  jackpot(){[523,659,784,1047,1319,1568].forEach((f,i)=>setTimeout(()=>this.b(f,.15),i*80));}
}
const snd=new Snd();

function initBg(){
  const cv=document.getElementById('bg-canvas'),ctx=cv.getContext('2d');
  let w,h,ps=[];
  const rs=()=>{w=cv.width=innerWidth;h=cv.height=innerHeight;};rs();
  window.addEventListener('resize',rs);
  for(let i=0;i<50;i++)ps.push({x:Math.random()*1e3,y:Math.random()*1e3,vx:(Math.random()-.5)*.2,vy:(Math.random()-.5)*.2,r:Math.random()*1.5+.3,a:Math.random()});
  (function fr(){ctx.clearRect(0,0,w,h);ps.forEach(p=>{p.x+=p.vx;p.y+=p.vy;if(p.x<0)p.x=w;if(p.x>w)p.x=0;if(p.y<0)p.y=h;if(p.y>h)p.y=0;ctx.beginPath();ctx.arc(p.x,p.y,p.r,0,Math.PI*2);ctx.fillStyle=`rgba(212,175,55,${p.a*.12})`;ctx.fill();});requestAnimationFrame(fr);})();
}
let _tt;
function showToast(msg){clearTimeout(_tt);let t=document.querySelector('.toast');if(!t){t=document.createElement('div');t.className='toast';document.body.appendChild(t);}t.textContent=msg;_tt=setTimeout(()=>t?.remove(),2500);}
function burst(win){const e=win?['‚≠ê','‚ú®','üí∞','üéâ']:['üí®'];for(let i=0;i<(win?8:3);i++){const el=document.createElement('div');el.className='particle';el.textContent=e[~~(Math.random()*e.length)];el.style.left=(innerWidth/2+(Math.random()-.5)*60)+'px';el.style.top='200px';el.style.animationDelay=(Math.random()*.3)+'s';document.body.appendChild(el);setTimeout(()=>el.remove(),1500);}}

function BetInput({value,onChange,balance}){
  return <div>
    <div className="fld"><div className="flbl">–°—Ç–∞–≤–∫–∞ ‚òÖ</div><input className="inp" type="number" value={value} onChange={e=>onChange(+e.target.value)}/></div>
    <div className="pres">
      {[50,100,250,500].map(v=><button key={v} className={`pre ${value===v?'on':''}`} onClick={()=>{snd.i();snd.click();onChange(v);}}>{v}</button>)}
      <button className="pre" onClick={()=>{snd.i();snd.click();onChange(Math.floor(balance/2));}}>¬Ω</button>
      <button className="pre" onClick={()=>{snd.i();snd.click();onChange(balance);}}>MAX</button>
    </div>
  </div>;
}

// ================================================================
// –°–¢–†–ê–ù–ò–¶–´
// ================================================================

function Registration({onDone}){
  const [step,setStep]=useState(1);
  const [name,setName]=useState(tgUser?.first_name||'');
  const [err,setErr]=useState('');
  const [loading,setLoading]=useState(false);

  async function submit(){
    const n=name.trim();
    if(n.length<2||n.length>20){setErr('–û—Ç 2 –¥–æ 20 —Å–∏–º–≤–æ–ª–æ–≤');return;}
    if(!/^[a-zA-Z–∞-—è–ê-–Ø0-9_-]+$/.test(n)){setErr('–¢–æ–ª—å–∫–æ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã, _ –∏ -');return;}
    setLoading(true);setErr('');
    const ref=tg?.initDataUnsafe?.start_param?.replace('ref_','');
    const r=await api('register',{username:n,ref_id:ref?+ref:null});
    if(r.ok){snd.i();snd.win();onDone({username:n,balance:r.balance||500,vip:1});}
    else{setErr(r.error||'–û—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π —Å–Ω–æ–≤–∞.');setLoading(false);}
  }

  if(step===1)return(
    <div className="welcome">
      <div className="wlogo">ROYAL KENO KZ</div>
      <div style={{fontSize:11,color:'var(--mut)',letterSpacing:3,textTransform:'uppercase',marginBottom:24}}>–û–Ω–ª–∞–π–Ω –∫–∞–∑–∏–Ω–æ</div>
      <div style={{fontSize:34,marginBottom:24}}>üé∞ üÉè üé° üöÄ üé≤</div>
      <div style={{width:'100%',marginBottom:20}}>
        {[['üí∞','–°—Ç–∞—Ä—Ç–æ–≤—ã–π –±–∞–ª–∞–Ω—Å 500 ‚òÖ'],['üéÅ','–ë–æ–Ω—É—Å –∫–∞–∂–¥—ã–µ 24 —á–∞—Å–∞'],['üèÜ','–¢–û–ü-10 –∏–≥—Ä–æ–∫–æ–≤'],['üë•','–†–µ—Ñ–µ—Ä–∞–ª–∫–∞ +500 ‚òÖ'],['üîí','–ê–Ω–æ–Ω–∏–º–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏ USDT']].map(([ic,tx])=>(
          <div key={tx} className="perk"><span style={{fontSize:20}}>{ic}</span><span style={{fontSize:13}}>{tx}</span></div>
        ))}
      </div>
      <button className="btn btn-gold" onClick={()=>setStep(2)}>üé∞ –ù–ê–ß–ê–¢–¨ –ò–ì–†–ê–¢–¨</button>
    </div>
  );

  return(
    <div style={{padding:'20px 4px'}}>
      <div style={{textAlign:'center',marginBottom:20}}>
        <div style={{fontSize:36,marginBottom:8,animation:'float 2s ease infinite'}}>üëë</div>
        <div style={{fontFamily:"'Cinzel',serif",fontSize:16,fontWeight:700,marginBottom:4}}>–°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å</div>
      </div>
      <div className="fld">
        <div className="flbl">–ù–∏–∫–Ω–µ–π–º</div>
        <input className="inp" value={name} onChange={e=>setName(e.target.value)} placeholder="Lucky_Player" maxLength={20} onKeyDown={e=>e.key==='Enter'&&submit()} autoFocus/>
        {err&&<div style={{color:'var(--ruby)',fontSize:12,marginTop:5}}>{err}</div>}
      </div>
      <div style={{fontSize:11,color:'var(--mut)',marginBottom:16}}>2‚Äì20 —Å–∏–º–≤–æ–ª–æ–≤ ¬∑ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã, _ –∏ -</div>
      <button className="btn btn-gold" onClick={submit} disabled={loading}>{loading?<><div className="spinner"/>–°–û–ó–î–ê–Å–ú...</>:'‚úÖ –°–û–ó–î–ê–¢–¨ –ü–†–û–§–ò–õ–¨'}</button>
      <button className="btn btn-ghost" onClick={()=>setStep(1)}>‚Üê –ù–ê–ó–ê–î</button>
    </div>
  );
}

function ProfilePage({profile,balance,onRefresh}){
  const profit=(profile.total_win||0)-(profile.total_bet||0);
  const wr=profile.games>0?((profile.wins/profile.games)*100).toFixed(1):0;
  const vip=profile.vip||1;

  // VIP –ø—Ä–æ–≥—Ä–µ—Å—Å
  const VIP_REQ=[0,0,10000,50000,200000,500000];
  const VIP_NAMES=['','BRONZE','SILVER','GOLD','PLATINUM','DIAMOND'];
  const VIP_COLORS=['','#CD7F32','#C0C0C0','#FFD700','#E5E4E2','#b9f2ff'];
  const curBet=profile.total_bet||0;
  const nextReq=VIP_REQ[vip+1]||VIP_REQ[5];
  const curReq=VIP_REQ[vip]||0;
  const pct=vip>=5?100:Math.min(100,Math.floor((curBet-curReq)/(nextReq-curReq)*100));

  const [showSeed,setShowSeed]=useState(false);

  return <div>
    <div className="card" style={{textAlign:'center',padding:'20px 15px'}}>
      <div className="avatar">üëë</div>
      <div style={{fontFamily:"'Cinzel',serif",fontSize:18,fontWeight:700,marginBottom:6}}>{profile.username}</div>
      <div className="vip-b" style={{background:`linear-gradient(135deg,${VIP_COLORS[vip]}88,${VIP_COLORS[vip]})`,marginBottom:10}}>
        ‚òÖ VIP {vip} ¬∑ {VIP_NAMES[vip]}
      </div>
      {/* VIP –ø—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä */}
      {vip<5&&<div style={{width:'100%',margin:'8px 0'}}>
        <div style={{display:'flex',justifyContent:'space-between',fontSize:10,color:'var(--mut)',marginBottom:4}}>
          <span>{curBet.toLocaleString()} ‚òÖ</span>
          <span>–¥–æ VIP {vip+1}: {nextReq.toLocaleString()} ‚òÖ</span>
        </div>
        <div style={{height:6,background:'rgba(255,255,255,.06)',borderRadius:3,overflow:'hidden'}}>
          <div style={{height:'100%',width:pct+'%',background:`linear-gradient(90deg,${VIP_COLORS[vip]},${VIP_COLORS[vip+1]||'#FFD700'})`,borderRadius:3,transition:'width .5s ease'}}/>
        </div>
        <div style={{fontSize:10,color:'var(--mut)',textAlign:'right',marginTop:3}}>{pct}%</div>
      </div>}
      {vip>=5&&<div style={{fontSize:11,color:'var(--gold2)',marginTop:4}}>üèÜ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å!</div>}
      <div style={{fontFamily:"'Cinzel',serif",fontSize:28,fontWeight:900,color:'var(--gold2)',marginTop:10}}>{balance.toLocaleString()} ‚òÖ</div>
    </div>

    <div className="card">
      <div className="ctit">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
      {[['–°—Ç–∞–≤–æ–∫ –≤—Å–µ–≥–æ',(profile.total_bet||0).toLocaleString()+' ‚òÖ'],
        ['–í—ã–∏–≥—Ä–∞–Ω–æ',(profile.total_win||0).toLocaleString()+' ‚òÖ'],
        ['–ü—Ä–æ—Ñ–∏—Ç',(profit>=0?'+':'')+profit.toLocaleString()+' ‚òÖ',profit>=0?'var(--em2)':'var(--ruby)'],
        ['–ò–≥—Ä —Å—ã–≥—Ä–∞–Ω–æ',profile.games||0],
        ['–ü–æ–±–µ–¥',profile.wins||0],
        ['–í–∏–Ω—Ä–µ–π—Ç',wr+'%','var(--gold2)']
      ].map(([k,v,c])=>(
        <div key={k} className="sl">
          <span className="sk">{k}</span>
          <span className="sv" style={{color:c||'var(--txt)'}}>{v}</span>
        </div>
      ))}
    </div>

    {/* –ü—Ä–æ–≤–∞–±–ª–∏ –§—ç–π—Ä */}
    <div className="card">
      <div className="ctit">üîê Provably Fair</div>
      <div style={{fontSize:11,color:'var(--mut)',marginBottom:10,lineHeight:1.6}}>
        –í—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è —á–µ—Å—Ç–Ω–æ. –¢—ã –º–æ–∂–µ—à—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ª—é–±—É—é –∏–≥—Ä—É –∑–Ω–∞—è seed.
      </div>
      <button className="btn btn-ghost" style={{marginBottom:0}}
        onClick={()=>setShowSeed(s=>!s)}>
        {showSeed?'üîí –°–∫—Ä—ã—Ç—å':'üîì –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–π seed'}
      </button>
      {showSeed&&<div style={{marginTop:10}}>
        <div className="flbl">Hashed Server Seed</div>
        <div style={{background:'var(--obs)',border:'1px solid var(--bdr)',borderRadius:7,padding:'8px 10px',fontSize:10,fontFamily:'monospace',color:'var(--gold2)',wordBreak:'break-all',marginBottom:8}}>
          {profile.hashed_seed||'‚Äî'}
        </div>
        <div className="flbl">Nonce (–∏–≥—Ä–∞ #)</div>
        <div style={{background:'var(--obs)',border:'1px solid var(--bdr)',borderRadius:7,padding:'8px 10px',fontSize:13,fontFamily:'monospace',color:'var(--em2)'}}>
          {profile.nonce||0}
        </div>
        <div style={{fontSize:10,color:'var(--mut)',marginTop:8,lineHeight:1.5}}>
          –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –∏–≥—Ä—ã nonce —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è. –ü–æ—Å–ª–µ —Ä–∞—É–Ω–¥–∞ –º—ã –ø–æ–∫–∞–∂–µ–º –Ω–∞—Å—Ç–æ—è—â–∏–π server seed ‚Äî —Ç—ã —Å–º–æ–∂–µ—à—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å–∞–º.
        </div>
      </div>}
    </div>

    <button className="btn btn-ghost" onClick={onRefresh}>üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
  </div>;
}

function BonusPage({balance,setBalance,vip}){
  const [status,setStatus]=useState(null);
  const [timeLeft,setTimeLeft]=useState('');
  const [loading,setLoading]=useState(false);
  const [cashback,setCashback]=useState(null);
  const [cbLoading,setCbLoading]=useState(false);
  const amt=Math.floor(20*(1+(vip-1)*.2));

  useEffect(()=>{
    api('bonus_status',{},true).then(r=>{
      if(r.ok){setStatus(r.can_claim?'can':'wait');if(r.time_left)setTimeLeft(r.time_left);}
    });
    api('cashback_status',{},true).then(r=>{if(r.ok)setCashback(r);});
  },[]);

  async function claim(){
    setLoading(true);
    const r=await api('claim_bonus');
    if(r.ok){snd.i();snd.win();burst(true);setBalance(b=>b+r.bonus);setStatus('win');showToast(`üéÅ +${r.bonus} ‚òÖ –ø–æ–ª—É—á–µ–Ω–æ!`);}
    else{setTimeLeft(r.time_left||'');setStatus('wait');}
    setLoading(false);
  }

  async function claimCashback(){
    setCbLoading(true);
    const r=await api('claim_cashback');
    if(r.ok){snd.i();snd.win();burst(true);setBalance(b=>b+r.cashback);showToast(`üí∞ –ö—ç—à–±—ç–∫ +${r.cashback} ‚òÖ!`);setCashback({available:false,days_left:7});}
    else showToast(r.error||'‚ùå –û—à–∏–±–∫–∞');
    setCbLoading(false);
  }

  return <div>
    {/* –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å */}
    <div className="card" style={{textAlign:'center',padding:'20px 15px'}}>
      <div style={{fontFamily:"'Cinzel',serif",fontSize:38,fontWeight:900,color:'var(--gold2)',animation:'float 2s ease infinite'}}>{amt} ‚òÖ</div>
      <div style={{fontSize:11,color:'var(--mut)',letterSpacing:2,textTransform:'uppercase',marginTop:4}}>–ë–æ–Ω—É—Å –¥–Ω—è ¬∑ VIP {vip}</div>
      {timeLeft&&<div style={{fontFamily:"'Cinzel',serif",fontSize:20,fontWeight:700,color:'var(--ruby)',marginTop:8}}>‚è≥ {timeLeft}</div>}
    </div>
    {status==='win'&&<div className="res rw"><div className="rbig">+{amt} ‚òÖ</div><div className="rsub">–ü–û–õ–£–ß–ï–ù–û!</div></div>}
    {status==='wait'&&<div className="res rt"><div className="rbig">‚è≥</div><div className="rsub">–°–õ–ï–î–£–Æ–©–ò–ô –ß–ï–†–ï–ó {timeLeft}</div></div>}
    {(status==='can'||!status)&&<button className="btn btn-gold" onClick={claim} disabled={loading||!status}>{loading?<><div className="spinner"/>–ü–û–õ–£–ß–ê–ï–ú...</>:'üéÅ –ü–û–õ–£–ß–ò–¢–¨ –ë–û–ù–£–°'}</button>}

    {/* –ö—ç—à–±—ç–∫ */}
    <div className="card" style={{marginTop:4}}>
      <div className="ctit">üí∞ –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π –∫—ç—à–±—ç–∫</div>
      {cashback===null&&<div className="loading"><div className="spinner"/>–ó–∞–≥—Ä—É–∂–∞–µ–º...</div>}
      {cashback?.available&&<>
        <div style={{textAlign:'center',marginBottom:12}}>
          <div style={{fontFamily:"'Cinzel',serif",fontSize:30,fontWeight:900,color:'var(--em2)'}}>+{cashback.cashback?.toLocaleString()} ‚òÖ</div>
          <div style={{fontSize:11,color:'var(--mut)',marginTop:4}}>5% –æ—Ç –ø—Ä–æ–∏–≥—Ä—ã—à–∞ {cashback.weekly_loss?.toLocaleString()} ‚òÖ –∑–∞ –Ω–µ–¥–µ–ª—é</div>
        </div>
        <button className="btn btn-em" onClick={claimCashback} disabled={cbLoading}>{cbLoading?<><div className="spinner"/>–ü–û–õ–£–ß–ê–ï–ú...</>:'üí∞ –ü–û–õ–£–ß–ò–¢–¨ –ö–≠–®–ë–≠–ö'}</button>
      </>}
      {cashback&&!cashback.available&&cashback.days_left&&<div style={{textAlign:'center',padding:'10px 0',color:'var(--mut)',fontSize:13}}>
        ‚è≥ –°–ª–µ–¥—É—é—â–∏–π –∫—ç—à–±—ç–∫ —á–µ—Ä–µ–∑ <b style={{color:'var(--gold2)'}}>{cashback.days_left} –¥–Ω.</b>
      </div>}
      {cashback&&!cashback.available&&!cashback.days_left&&<div style={{fontSize:12,color:'var(--mut)',lineHeight:1.6}}>
        –ü—Ä–æ–∏–≥—Ä–∞–π –º–∏–Ω–∏–º—É–º <b style={{color:'var(--gold2)'}}>{cashback.min_loss?.toLocaleString()||'1,000'} ‚òÖ</b> –∑–∞ –Ω–µ–¥–µ–ª—é —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å 5% –æ–±—Ä–∞—Ç–Ω–æ.<br/>
        –°–µ–π—á–∞—Å: <b style={{color:'var(--txt)'}}>{cashback.current_loss?.toLocaleString()||0} ‚òÖ</b>
      </div>}
    </div>

    {/* –¢–∞–±–ª–∏—Ü–∞ VIP –±–æ–Ω—É—Å–æ–≤ */}
    <div className="card">
      <div className="ctit">VIP –±–æ–Ω—É—Å—ã</div>
      {[1,2,3,4,5].map(v=><div key={v} className="sl">
        <span className="sk">VIP {v} {'‚≠ê'.repeat(v)}</span>
        <span className="sv" style={{color:vip>=v?'var(--gold2)':'var(--mut)'}}>{Math.floor(20*(1+(v-1)*.2))} ‚òÖ/–¥–µ–Ω—å</span>
      </div>)}
    </div>
  </div>;
}

function TopupPage({balance,setBalance}){
  const [amount,setAmount]=useState(10);
  const [step,setStep]=useState(1); // 1=—Ñ–æ—Ä–º–∞ 2=–æ–∂–∏–¥–∞–Ω–∏–µ 3=–≥–æ—Ç–æ–≤–æ
  const [inv,setInv]=useState(null);
  const [loading,setLoading]=useState(false);
  const [rateStr,setRateStr]=useState('1 USDT = 76 ‚òÖ');
  const stars=Math.floor(amount/0.013);

  useEffect(()=>{api('rate',{},true).then(r=>{if(r.ok)setRateStr(r.formatted||r.rate_str||rateStr);});},[]);

  async function create(){
    if(amount<1)return;setLoading(true);
    const r=await api('create_invoice',{amount_usdt:amount});
    if(r.ok){setInv(r);setStep(2);}else showToast('‚ùå –û—à–∏–±–∫–∞');
    setLoading(false);
  }
  async function check(){
    setLoading(true);
    const r=await api('check_invoice',{invoice_id:inv?.invoice_id});
    if(r.ok&&r.paid){
      snd.i();snd.win();burst(true);
      setBalance(b=>b+r.stars);
      setInv(i=>({...i,stars:r.stars}));
      setStep(3);
      showToast(`‚úÖ +${r.stars} ‚òÖ –∑–∞—á–∏—Å–ª–µ–Ω–æ!`);
    }else showToast('‚è≥ –ù–µ –æ–ø–ª–∞—á–µ–Ω–æ');
    setLoading(false);
  }

  if(step===3)return <div>
    <div className="res rw" style={{marginTop:0}}>
      <div className="rbig">+{(inv?.stars_total||inv?.stars||0).toLocaleString()} ‚òÖ</div>
      <div className="rsub">{inv?.bonus_stars>0?`–í–ö–õ–Æ–ß–ê–Ø –ë–û–ù–£–° x2 üéÅ`:'–ë–ê–õ–ê–ù–° –ü–û–ü–û–õ–ù–ï–ù!'}</div>
    </div>
    {inv?.bonus_stars>0&&<div className="card" style={{marginTop:8,background:'rgba(0,200,120,.06)',border:'1px solid rgba(0,200,120,.25)'}}>
      <div style={{display:'flex',justifyContent:'space-between',alignItems:'center'}}>
        <span style={{fontSize:13}}>üí∞ –û—Å–Ω–æ–≤–Ω–∞—è —Å—É–º–º–∞</span>
        <span style={{fontFamily:"'Cinzel',serif",fontWeight:700,color:'var(--gold2)'}}>{(inv?.stars||0).toLocaleString()} ‚òÖ</span>
      </div>
      <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginTop:6}}>
        <span style={{fontSize:13}}>üéÅ –ë–æ–Ω—É—Å –ø–µ—Ä–≤–æ–≥–æ –¥–µ–ø–æ–∑–∏—Ç–∞</span>
        <span style={{fontFamily:"'Cinzel',serif",fontWeight:700,color:'var(--em2)'}}>+{(inv?.bonus_stars||0).toLocaleString()} ‚òÖ</span>
      </div>
    </div>}
    <div className="card" style={{marginTop:8,textAlign:'center'}}>
      <div style={{fontSize:32,marginBottom:8}}>‚úÖ</div>
      <div style={{fontWeight:700}}>–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ</div>
      <div style={{color:'var(--mut)',fontSize:12,marginTop:4}}>–ë–∞–ª–∞–Ω—Å: {balance.toLocaleString()} ‚òÖ</div>
      {inv?.demo&&<div style={{color:'var(--ruby)',fontSize:11,marginTop:8}}>üîß –î–µ–º–æ —Ä–µ–∂–∏–º</div>}
    </div>
    <button className="btn btn-gold" onClick={()=>{setStep(1);setInv(null);}}>üí≥ –ü–æ–ø–æ–ª–Ω–∏—Ç—å –µ—â—ë</button>
  </div>;

  if(step===2)return <div>
    <div className="demo-badge">üîß –î–ï–ú–û –†–ï–ñ–ò–ú</div>
    <div className="card" style={{textAlign:'center'}}>
      <div style={{fontSize:36,marginBottom:10}}>üí≥</div>
      <div style={{fontFamily:"'Cinzel',serif",fontSize:18,fontWeight:700,marginBottom:4}}>–°—á—ë—Ç —Å–æ–∑–¥–∞–Ω</div>
      <div style={{color:'var(--mut)',fontSize:12,marginBottom:14}}>–í —Ä–µ–∞–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ ‚Äî –æ–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ @CryptoBot</div>
      {[
        ['–°—É–º–º–∞',`${inv?.amount_usdt} USDT`],
        ['–û—Å–Ω–æ–≤–Ω–∞—è —Å—É–º–º–∞',`${(inv?.stars||0).toLocaleString()} ‚òÖ`],
        ...(inv?.bonus_stars>0?[['üéÅ –ë–æ–Ω—É—Å x2',`+${(inv?.bonus_stars||0).toLocaleString()} ‚òÖ`]]:[]),
        ['–ò—Ç–æ–≥–æ –∑–∞—á–∏—Å–ª–∏—Ç—Å—è',`${(inv?.stars_total||inv?.stars||0).toLocaleString()} ‚òÖ`],
        ...(DEMO_MODE?[['–†–µ–∂–∏–º','üîß –î–µ–º–æ']]:[]),
      ].map(([k,v])=>(
        <div key={k} className="sl"><span className="sk">{k}</span><span className="sv">{v}</span></div>
      ))}
    </div>
    {/* –í —Ä–µ–∞–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ –∑–¥–µ—Å—å –±—É–¥–µ—Ç —Å—Å—ã–ª–∫–∞ –Ω–∞ @CryptoBot */}
    {/* <a href={inv?.pay_url} target="_blank"><button className="btn btn-gold">üí≥ –û–¢–ö–†–´–¢–¨ @CRYPTOBOT</button></a> */}
    <button className="btn btn-em" onClick={check} disabled={loading}>{loading?<><div className="spinner"/>–ó–ê–ß–ò–°–õ–Ø–ï–ú...</>:'‚úÖ –ó–ê–ß–ò–°–õ–ò–¢–¨ –î–ï–ú–û'}</button>
    <button className="btn btn-ghost" onClick={()=>setStep(1)}>‚Üê –ù–ê–ó–ê–î</button>
  </div>;

  return <div>
    <div className="demo-badge">üîß –î–ï–ú–û ‚Äî —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–µ–Ω–µ–≥ –Ω–µ—Ç</div>
    {/* –ë–∞–Ω–Ω–µ—Ä –ø–µ—Ä–≤–æ–≥–æ –¥–µ–ø–æ–∑–∏—Ç–∞ */}
    {!_demo.had_deposit&&DEMO_MODE&&<div style={{background:'linear-gradient(135deg,rgba(0,200,120,.1),rgba(0,200,120,.05))',border:'1px solid rgba(0,200,120,.3)',borderRadius:12,padding:'12px 14px',marginBottom:12,display:'flex',alignItems:'center',gap:10}}>
      <span style={{fontSize:28}}>üéÅ</span>
      <div><div style={{fontWeight:700,fontSize:13,color:'var(--em2)'}}>–ë–æ–Ω—É—Å –ø–µ—Ä–≤–æ–≥–æ –¥–µ–ø–æ–∑–∏—Ç–∞!</div><div style={{fontSize:11,color:'var(--mut)',marginTop:2}}>–ü–µ—Ä–≤–æ–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ √ó 2 ‚Äî –º—ã —É–¥–≤–æ–∏–º —Å—É–º–º—É!</div></div>
    </div>}
    <div className="rbadge">üìä {rateStr}</div>
    <div className="card">
      <div className="ctit">–°—É–º–º–∞</div>
      <div className="fld"><div className="flbl">–í USDT</div><input className="inp" type="number" value={amount} onChange={e=>setAmount(+e.target.value)}/></div>
      <div className="pres">{[5,10,25,50,100].map(v=><button key={v} className={`pre ${amount===v?'on':''}`} onClick={()=>setAmount(v)}>{v}$</button>)}</div>
      {amount>=1&&<div style={{textAlign:'center',padding:'8px 0',color:'var(--gold2)',fontSize:15,fontFamily:"'Cinzel',serif",fontWeight:700}}>
        –ó–∞—á–∏—Å–ª–∏—Ç—Å—è: {Math.floor(amount/0.013).toLocaleString()} ‚òÖ
      </div>}
    </div>
    <button className="btn btn-gold" onClick={create} disabled={amount<1||loading}>{loading?<><div className="spinner"/>–°–û–ó–î–ê–Å–ú...</>:`üí≥ –ü–û–ü–û–õ–ù–ò–¢–¨ (–î–ï–ú–û)`}</button>
  </div>;
}

function WithdrawPage({balance,setBalance}){
  const [stars,setStars]=useState(100);
  const [step,setStep]=useState(1);
  const [loading,setLoading]=useState(false);
  const [rateStr,setRateStr]=useState('');
  const MIN=100; // –≤ –¥–µ–º–æ –º–∏–Ω–∏–º—É–º 100, –≤ —Ä–µ–∞–ª–µ –±—É–¥–µ—Ç 1000
  const usdt=parseFloat((stars*0.013).toFixed(2));

  useEffect(()=>{api('rate',{},true).then(r=>{if(r.ok)setRateStr(r.formatted||r.rate_str||'');});},[]);

  async function withdraw(){
    if(stars<MIN||stars>balance)return;
    setLoading(true);
    const r=await api('withdraw',{stars});
    if(r.ok){snd.i();snd.win();setBalance(b=>b-stars);setStep(2);}
    else showToast(r.error||'‚ùå –û—à–∏–±–∫–∞');
    setLoading(false);
  }

  if(step===2)return <div>
    <div className="res rw" style={{marginTop:0}}><div className="rbig">{usdt} USDT</div><div className="rsub">–í–´–í–û–î –í–´–ü–û–õ–ù–ï–ù</div></div>
    <div className="card" style={{marginTop:12,textAlign:'center'}}>
      <div style={{fontSize:32,marginBottom:8}}>‚úÖ</div>
      <div style={{fontWeight:700}}>–í—ã–≤–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω</div>
      <div style={{color:'var(--mut)',fontSize:12,marginTop:4}}>–û—Å—Ç–∞—Ç–æ–∫: {balance.toLocaleString()} ‚òÖ</div>
      <div style={{color:'var(--ruby)',fontSize:11,marginTop:8}}>üîß –î–µ–º–æ —Ä–µ–∂–∏–º ‚Äî —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–µ–Ω–µ–≥ –Ω–µ—Ç</div>
    </div>
    <button className="btn btn-gold" onClick={()=>setStep(1)}>üí∞ –í—ã–≤–µ—Å—Ç–∏ –µ—â—ë</button>
  </div>;

  return <div>
    <div className="demo-badge">üîß –î–ï–ú–û ‚Äî —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–µ–Ω–µ–≥ –Ω–µ—Ç</div>
    {rateStr&&<div className="rbadge">üìä {rateStr}</div>}
    <div className="card">
      <div className="ctit">–°—É–º–º–∞ –≤—ã–≤–æ–¥–∞</div>
      <div style={{textAlign:'right',fontSize:12,color:'var(--mut)',marginBottom:8}}>–î–æ—Å—Ç—É–ø–Ω–æ: {balance.toLocaleString()} ‚òÖ</div>
      <div className="fld"><div className="flbl">–í –∑–≤—ë–∑–¥–∞—Ö ‚òÖ</div><input className="inp" type="number" value={stars} onChange={e=>setStars(+e.target.value)}/></div>
      <div className="pres">{[100,500,1000,5000].map(v=><button key={v} className={`pre ${stars===v?'on':''}`} onClick={()=>setStars(v)}>{v>=1000?v/1000+'K':v}</button>)}<button className="pre" onClick={()=>setStars(balance)}>MAX</button></div>
      {stars>=MIN&&<div style={{textAlign:'center',padding:'8px 0',color:'var(--em2)',fontSize:15,fontFamily:"'Cinzel',serif",fontWeight:700}}>
        –ü–æ–ª—É—á–∏—Ç–µ: {usdt} USDT
      </div>}
    </div>
    {/* –í —Ä–µ–∞–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –±–ª–æ–∫ —Å @CryptoBot */}
    {/* <div className="card"><div className="ctit">–ö—É–¥–∞</div>... Crypto Pay TRC20 ...</div> */}
    {stars>balance&&<div style={{color:'var(--ruby)',fontSize:12,marginBottom:8,textAlign:'center'}}>‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–≤—ë–∑–¥</div>}
    {stars<MIN&&<div style={{color:'var(--ruby)',fontSize:12,marginBottom:8,textAlign:'center'}}>‚ùå –ú–∏–Ω–∏–º—É–º {MIN} ‚òÖ</div>}
    <button className="btn btn-gold" onClick={withdraw} disabled={stars<MIN||stars>balance||loading}>{loading?<><div className="spinner"/>–í–´–í–û–î–ò–ú...</>:`üí∞ –í–´–í–ï–°–¢–ò (–î–ï–ú–û)`}</button>
  </div>;
}

function HistoryPage(){
  const [items,setItems]=useState(null);
  const ICO={keno:'üé∞',slots:'üé∞',blackjack:'üÉè',roulette:'üé°',crash:'üöÄ'};
  useEffect(()=>{api('history',{},true).then(r=>{setItems(r.ok?r.history:[]);});},[]);
  const fmt=iso=>{try{const d=new Date(iso);return`${d.getDate()}.${String(d.getMonth()+1).padStart(2,'0')} ${d.getHours()}:${String(d.getMinutes()).padStart(2,'0')}`;}catch{return'';}};
  if(!items)return <div className="loading"><div className="spinner"/>–ó–∞–≥—Ä—É–∂–∞–µ–º...</div>;
  if(!items.length)return <div style={{textAlign:'center',padding:40,color:'var(--mut)'}}>üìú –°—ã–≥—Ä–∞–π—Ç–µ –ø–µ—Ä–≤—É—é –∏–≥—Ä—É!</div>;
  return <div className="card"><div className="ctit">–ü–æ—Å–ª–µ–¥–Ω–∏–µ –∏–≥—Ä—ã</div>
    {items.map((h,i)=>{
      const p=(h.win||0)-(h.bet||0);
      return<div key={i} className="hrow">
        <div className="hico">{ICO[h.game]||'üé≤'}</div>
        <div className="hinfo">
          <div className="hgame">{(h.game||'').toUpperCase()}</div>
          <div className="hdate">{fmt(h.date)} ¬∑ —Å—Ç–∞–≤–∫–∞ {(h.bet||0).toLocaleString()} ‚òÖ</div>
          {h.nonce!==undefined&&<div style={{fontSize:9,color:'var(--mut)',marginTop:1}}>–ò–≥—Ä–∞ #{h.nonce}</div>}
        </div>
        <div className={`hamt ${p>=0?'w':'l'}`}>{p>=0?'+':''}{p.toLocaleString()} ‚òÖ</div>
      </div>;
    })}
  </div>;
}

function TopPage(){
  const [top,setTop]=useState(null);
  useEffect(()=>{api('top',{},true).then(r=>{setTop(r.ok?r.top:[]);});},[]);
  const RC=i=>i===0?'g':i===1?'s':i===2?'b':'';
  const M=['ü•á','ü•à','ü•â'];
  if(!top)return <div className="loading"><div className="spinner"/>–ó–∞–≥—Ä—É–∂–∞–µ–º...</div>;
  return <div className="card"><div className="ctit">üèÜ –¢–û–ü –∏–≥—Ä–æ–∫–æ–≤</div>
    {top.map((p,i)=><div key={i} className="trow"><div className={`trank ${RC(i)}`}>{i<3?M[i]:i+1+'.'}</div><div className="tname">{p.username||'–ê–Ω–æ–Ω–∏–º'} <span style={{fontSize:10,color:'var(--mut)'}}>VIP-{p.vip}</span></div><div className="tbal">{(p.balance||0).toLocaleString()} ‚òÖ</div></div>)}
  </div>;
}

function RefPage({userId}){
  const [count,setCount]=useState(0);
  const botName="YOUR_BOT"; // ‚Üê –∑–∞–º–µ–Ω–∏ –Ω–∞ @username –±–æ—Ç–∞
  const link=`https://t.me/${botName}?start=ref_${userId}`;
  useEffect(()=>{api('referrals',{},true).then(r=>{if(r.ok)setCount(r.count||0);});},[]);
  function copy(){navigator.clipboard?.writeText(link).then(()=>showToast('‚úÖ –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!'));snd.click();}
  return <div>
    <div className="card" style={{textAlign:'center',padding:'18px 15px'}}>
      <div style={{fontSize:36,marginBottom:8}}>üë•</div>
      <div style={{fontFamily:"'Cinzel',serif",fontSize:16,fontWeight:700,marginBottom:4}}>–†–µ—Ñ–µ—Ä–∞–ª–∫–∞</div>
      <div style={{color:'var(--mut)',fontSize:12}}>+500 ‚òÖ –∑–∞ –∫–∞–∂–¥–æ–≥–æ –¥—Ä—É–≥–∞</div>
    </div>
    <div style={{display:'flex',gap:10,marginBottom:14}}>
      <div className="rss"><div className="rssv">{count}</div><div className="rssl">–î—Ä—É–∑–µ–π</div></div>
      <div className="rss"><div className="rssv">{(count*500).toLocaleString()}</div><div className="rssl">–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ ‚òÖ</div></div>
    </div>
    <div className="card"><div className="ctit">–í–∞—à–∞ —Å—Å—ã–ª–∫–∞</div>
      <div className="ref-link" onClick={copy}>{link}</div>
      <div className="g2"><button className="btn btn-gold" onClick={copy}>üìã –ö–û–ü–ò–†–û–í–ê–¢–¨</button><button className="btn btn-ghost" onClick={()=>tg?.switchInlineQuery?.(`–ò–≥—Ä–∞–π –≤ Royal Keno KZ! üé∞\n${link}`)}>üì§ –ü–û–î–ï–õ–ò–¢–¨–°–Ø</button></div>
    </div>
  </div>;
}

// ================================================================
// –ò–ì–†–´
// ================================================================

function CrashGame({balance,setBalance}){
  const [bet,setBet]=useState(50);
  const [target,setTarget]=useState(2.0);
  const [phase,setPhase]=useState('idle');
  const [mult,setMult]=useState(1.00);
  const [crashAt,setCrashAt]=useState(null);
  const [result,setResult]=useState(null);
  const iv=useRef(null),cv=useRef(null),pts=useRef([]);
  function gen(){const r=Math.random();return r<.05?1.0:Math.min(Math.round((.95/r)*100)/100,100);}
  function draw(){const c=cv.current;if(!c)return;const ctx=c.getContext('2d'),w=c.width,h=c.height;ctx.clearRect(0,0,w,h);if(pts.current.length<2)return;const p=pts.current,mx=Math.max(...p,2);const tx=i=>(i/(p.length-1))*w*.9+w*.05;const ty=v=>h-(v/mx)*h*.85-h*.05;ctx.beginPath();ctx.moveTo(tx(0),ty(p[0]));p.forEach((v,i)=>i>0&&ctx.lineTo(tx(i),ty(v)));ctx.strokeStyle='#00FF9A';ctx.lineWidth=2.5;ctx.shadowColor='#00FF9A';ctx.shadowBlur=8;ctx.stroke();}
  function start(){
    if(bet<50||bet>balance)return;snd.i();
    const cp=gen();setCrashAt(cp);setPhase('fly');setResult(null);setBalance(b=>b-bet);pts.current=[1];let cur=1.0;
    iv.current=setInterval(()=>{
      cur=Math.round((cur+cur*.025)*100)/100;setMult(cur);pts.current.push(cur);draw();
      if(cur>=target){clearInterval(iv.current);const win=Math.floor(bet*target);setBalance(b=>b+win);setPhase('idle');setResult({win,profit:win-bet,ok:true});snd.win();burst(true);api('play',{game:'crash',bet,win});return;}
      if(cur>=cp){clearInterval(iv.current);setPhase('boom');setResult({win:0,profit:-bet,ok:false});snd.lose();setTimeout(()=>setPhase('idle'),1500);api('play',{game:'crash',bet,win:0});}
    },120);
  }
  useEffect(()=>()=>clearInterval(iv.current),[]);
  return <div>
    <div className="arena">
      <canvas ref={cv} width="400" height="185" style={{position:'absolute',inset:0,width:'100%',height:'100%'}}/>
      <div className={`cmult ${phase}`}>{mult.toFixed(2)}x</div>
      <div className={`cst ${phase}`}>{phase==='idle'&&'–°–¢–ê–í–¨–¢–ï'}{phase==='fly'&&'üöÄ –í –ü–û–õ–Å–¢–ï'}{phase==='boom'&&`üí• –ö–†–ê–® ${crashAt}x`}</div>
    </div>
    {phase==='idle'&&<><BetInput value={bet} onChange={setBet} balance={balance}/>
      <div className="card"><div className="ctit">–ó–∞–±—Ä–∞—Ç—å –Ω–∞</div>
        <div className="g3" style={{marginBottom:8}}>{[1.5,2,3,5,10].map(p=><button key={p} className={`pre ${target===p?'on':''}`} onClick={()=>setTarget(p)}>x{p}</button>)}</div>
        <input className="inp" type="number" step=".1" value={target} onChange={e=>setTarget(Math.max(1.01,Math.min(100,+e.target.value||1.01)))}/>
      </div>
      <button className="btn btn-gold" onClick={start} disabled={bet<50||bet>balance}>üöÄ –ó–ê–ü–£–°–¢–ò–¢–¨</button>
    </>}
    {result&&<div className={`res ${result.ok?'rw':'rl'}`}><div className="rbig">{result.ok?`+${result.win.toLocaleString()}`:result.profit.toLocaleString()} ‚òÖ</div><div className="rsub">{result.ok?`–ó–ê–ë–†–ê–õ–ò –ù–ê x${target}`:`–£–ü–ê–õ –ù–ê x${crashAt}`}</div></div>}
  </div>;
}

const SYMS=['üçã','üçä','üçá','üîî','üíé','7Ô∏è‚É£','üé∞'];
const WGTS=[30,25,20,12,8,4,1];
// –í—ã–ø–ª–∞—Ç—ã –∑–∞ 3 –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö ‚Äî –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–µ–Ω—ã –¥–ª—è RTP ~85%
const PAYS={'üçã':3,'üçä':5,'üçá':8,'üîî':15,'üíé':40,'7Ô∏è‚É£':80,'üé∞':300};
// –í—ã–ø–ª–∞—Ç—ã –∑–∞ 2 –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö (–ª—é–±—ã–µ) ‚Äî –≤–æ–∑–≤—Ä–∞—Ç —Å—Ç–∞–≤–∫–∏
const PAYS2={'üçã':1,'üçä':1,'üçá':1,'üîî':2,'üíé':3,'7Ô∏è‚É£':5,'üé∞':10};
function wr(){let s=WGTS.reduce((a,b)=>a+b),r=Math.random()*s;for(let i=0;i<SYMS.length;i++){r-=WGTS[i];if(r<=0)return SYMS[i];}return SYMS[0];}

function SlotsGame({balance,setBalance}){
  const [bet,setBet]=useState(50);
  const [reels,setReels]=useState(['üíé','üíé','üíé']);
  const [spin,setSpin]=useState([false,false,false]);
  const [win,setWin]=useState(null);
  const [busy,setBusy]=useState(false);
  function go(){
    if(bet<50||bet>balance||busy)return;snd.i();setBusy(true);setWin(null);setBalance(b=>b-bet);
    const final=[wr(),wr(),wr()];setSpin([true,true,true]);
    [0,1,2].forEach(i=>setTimeout(()=>{snd.deal();setSpin(s=>{const n=[...s];n[i]=false;return n;});setReels(r=>{const n=[...r];n[i]=final[i];return n;});
      if(i===2){const [a,b2,c]=final;let w=0,txt='';
        if(a===b2&&b2===c){
          w=Math.floor(bet*PAYS[a]);txt=`–¢—Ä–∏ ${a}! √ó${PAYS[a]}`;
        } else {
          // –î–≤–∞ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö ‚Äî –Ω–∞—Ö–æ–¥–∏–º –ø–∞—Ä—É –∏ –µ—ë –≤—ã–ø–ª–∞—Ç—É
          let pairSym=null;
          if(a===b2)pairSym=a;
          else if(b2===c)pairSym=b2;
          else if(a===c)pairSym=a;
          if(pairSym){w=Math.floor(bet*(PAYS2[pairSym]||1));txt=`–ü–∞—Ä–∞ ${pairSym} √ó${PAYS2[pairSym]||1}`;}
          else txt='–ù–µ—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π';
        }
        if(w>0){setBalance(b=>b+w);snd.win();if(w>bet*10)snd.jackpot();burst(true);}else snd.lose();
        setWin({w,profit:w-bet,txt});setBusy(false);api('play',{game:'slots',bet,win:w});
    },400+i*350));
  }
  return <div>
    <div className="smach">
      <div className="reels">{reels.map((s,i)=><div key={i} className={`reel${win?.w>0&&!spin[i]?' win':''}`}>{spin[i]?SYMS[~~(Math.random()*SYMS.length)]:s}</div>)}</div>
      <div className="sline"/>
    </div>
    <BetInput value={bet} onChange={setBet} balance={balance}/>
    <button className="btn btn-gold" onClick={go} disabled={busy||bet<50||bet>balance}>{busy?'‚è≥ –ö–†–£–¢–ò–¢–°–Ø...':'üé∞ –ö–†–£–¢–ò–¢–¨'}</button>
    {win&&<div className={`res ${win.w>0?'rw':'rl'}`}><div className="rbig">{win.w>0?`+${win.w.toLocaleString()}`:win.profit.toLocaleString()} ‚òÖ</div><div className="rsub">{win.txt}</div></div>}
    <div className="card" style={{marginTop:12}}>
      <div className="ctit">–í—ã–ø–ª–∞—Ç—ã</div>
      <div style={{fontSize:10,color:'var(--mut)',marginBottom:8}}>–ó–∞ 3 –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö:</div>
      {Object.entries(PAYS).map(([s,m])=><div key={s} className="sl">
        <span className="sk">{s}{s}{s}</span>
        <span className="sv" style={{color:'var(--gold2)'}}>√ó{m}</span>
      </div>)}
      <div style={{fontSize:10,color:'var(--mut)',margin:'8px 0'}}>–ó–∞ 2 –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö:</div>
      {Object.entries(PAYS2).map(([s,m])=><div key={s} className="sl">
        <span className="sk">{s}{s} + ?</span>
        <span className="sv" style={{color:'var(--em)',fontSize:11}}>√ó{m}</span>
      </div>)}
    </div>
  </div>;
}

const S5=['‚ô†','‚ô•','‚ô¶','‚ô£'],V5=['2','3','4','5','6','7','8','9','10','J','Q','K','A'];
function mkDk(){return V5.flatMap(v=>S5.map(s=>v+s)).sort(()=>Math.random()-.5);}
function cVal(c){const v=c.slice(0,-1);if('JQK'.includes(v))return 10;if(v==='A')return 11;return+v;}
function hVal(h){let t=h.reduce((a,c)=>a+cVal(c),0),ac=h.filter(c=>c.startsWith('A')).length;while(t>21&&ac){t-=10;ac--;}return t;}
function isR(c){return c.endsWith('‚ô•')||c.endsWith('‚ô¶');}
function Card({c,back}){if(back)return <div className="pc bk">üÇ†</div>;const v=c.slice(0,-1),s=c.slice(-1);return <div className={`pc ${isR(c)?'rd':'wh'}`}><div>{v}</div><div style={{fontSize:10}}>{s}</div><span className="pcs">{s}</span></div>;}

function BJGame({balance,setBalance}){
  const [bet,setBet]=useState(50);
  const [phase,setPhase]=useState('bet');
  const [deck,setDeck]=useState([]);
  const [player,setPlayer]=useState([]);
  const [dealer,setDealer]=useState([]);
  const [result,setResult]=useState(null);
  function deal(){if(bet<50||bet>balance)return;snd.i();const d=mkDk(),p=[d.pop(),d.pop()],dl=[d.pop(),d.pop()];setDeck(d);setPlayer(p);setDealer(dl);setResult(null);setBalance(b=>b-bet);snd.deal();setTimeout(()=>snd.deal(),150);setPhase('play');if(hVal(p)===21)setTimeout(()=>finish(p,dl,d,bet),400);}
  function hit(){const d=[...deck],p=[...player,d.pop()];snd.deal();setDeck(d);setPlayer(p);if(hVal(p)>21)finish(p,dealer,deck,bet);else if(hVal(p)===21)setTimeout(()=>finish(p,dealer,d,bet),300);}
  function stand(p2=player,dl2=dealer,d2=deck,b2=bet){const fd=[...dl2],fd2=[...d2];while(hVal(fd)<17)fd.push(fd2.pop());setDealer(fd);finish(p2,fd,fd2,b2);}
  function dbl(){if(balance<bet)return;setBalance(b=>b-bet);const nb=bet*2,d=[...deck],p=[...player,d.pop()];snd.deal();setDeck(d);setPlayer(p);if(hVal(p)>21)finish(p,dealer,d,nb);else stand(p,dealer,d,nb);}
  function finish(p,dl,d,b){const pv=hVal(p),dv=hVal(dl);let win=0,txt='',type='lose';if(pv>21)txt='üí• –ü–µ—Ä–µ–±–æ—Ä!';else if(pv===21&&p.length===2){win=Math.floor(b*2.5);txt='üéâ –ë–õ–≠–ö–î–ñ–ï–ö!';type='win';}else if(dv>21||pv>dv){win=b*2;txt='üéâ –ü–æ–±–µ–¥–∞!';type='win';}else if(pv===dv){win=b;txt='ü§ù –ù–∏—á—å—è';type='tie';}else txt='üòî –î–∏–ª–µ—Ä –ø–æ–±–µ–¥–∏–ª';if(win>0){setBalance(b2=>b2+win);snd.win();burst(win>b);}else snd.lose();setResult({win,profit:win-b,txt,type});setPhase('done');api('play',{game:'blackjack',bet:b,win});}
  return <div>
    <div className="felt">
      {phase!=='bet'&&<><div className="hlbl">–î–∏–ª–µ—Ä {phase==='done'?`(${hVal(dealer)})`:''}</div><div className="hand">{dealer.map((c,i)=><Card key={i} c={c} back={phase==='play'&&i===1}/>)}</div><div style={{borderTop:'1px solid rgba(255,255,255,.06)',margin:'7px 0'}}/><div className="hlbl">–í—ã ({hVal(player)})</div><div className="hand">{player.map((c,i)=><Card key={i} c={c}/>)}</div></>}
      {phase==='bet'&&<div style={{display:'flex',flexDirection:'column',alignItems:'center',justifyContent:'center',height:'100%',paddingTop:20}}><div style={{fontSize:42,animation:'float 2s ease infinite'}}>üÉè</div></div>}
    </div>
    {(phase==='bet'||phase==='done')&&<BetInput value={bet} onChange={setBet} balance={balance}/>}
    {phase==='bet'&&<button className="btn btn-gold" onClick={deal} disabled={bet<50||bet>balance}>üÉè –†–ê–ó–î–ê–¢–¨</button>}
    {phase==='play'&&<div className="g2"><button className="btn btn-em" onClick={hit}>üëä –ï–©–Å</button><button className="btn btn-ghost" onClick={()=>stand()}>‚úã –°–¢–û–ü</button>{player.length===2&&balance>=bet&&<button className="btn btn-gold" style={{gridColumn:'span 2'}} onClick={dbl}>üí∞ –£–î–í–û–ò–¢–¨</button>}</div>}
    {phase==='done'&&result&&<><div className={`res r${result.type}`}><div className="rbig">{result.win>0?`+${result.win.toLocaleString()}`:result.profit.toLocaleString()} ‚òÖ</div><div className="rsub">{result.txt}</div></div><button className="btn btn-gold" style={{marginTop:8}} onClick={()=>setPhase('bet')}>üîÑ –°–ù–û–í–ê</button></>}
  </div>;
}

const RN=new Set([1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36]);
const BT2=[{id:'red',l:'üî¥ –ö—Ä–∞—Å–Ω–æ–µ',m:2},{id:'black',l:'‚ö´ –ß—ë—Ä–Ω–æ–µ',m:2},{id:'even',l:'–ß–Å–¢–ù–û–ï',m:2},{id:'odd',l:'–ù–ï–ß–Å–¢–ù–û–ï',m:2},{id:'low',l:'1‚Äì18',m:2},{id:'high',l:'19‚Äì36',m:2}];
function RouletteGame({balance,setBalance}){
  const [bet,setBet]=useState(50);
  const [type,setType]=useState('red');
  const [spin,setSpin]=useState(false);
  const [result,setResult]=useState(null);
  const [rot,setRot]=useState(0);
  const [last,setLast]=useState(null);
  function go(){
    if(bet<50||bet>balance||spin)return;snd.i();setSpin(true);setResult(null);setBalance(b=>b-bet);
    const num=~~(Math.random()*37);setLast(num);setRot(r=>r+1440+Math.random()*360);
    setTimeout(()=>{const col=num===0?'green':RN.has(num)?'red':'black';let win=0;if(type==='red'&&col==='red')win=bet*2;else if(type==='black'&&col==='black')win=bet*2;else if(type==='even'&&num!==0&&num%2===0)win=bet*2;else if(type==='odd'&&num%2===1)win=bet*2;else if(type==='low'&&num>=1&&num<=18)win=bet*2;else if(type==='high'&&num>=19&&num<=36)win=bet*2;if(win>0){setBalance(b=>b+win);snd.win();burst(true);}else snd.lose();setResult({win,profit:win-bet,num,col});setSpin(false);api('play',{game:'roulette',bet,win});},2600);
  }
  return <div>
    <div className="ws"><div style={{position:'relative'}}><div className="wp"/><div className="wo" style={{transform:`rotate(${rot}deg)`}}><div className="wi">{last??'?'}</div></div></div></div>
    <div className="bts">{BT2.map(t=><button key={t.id} className={`bt ${type===t.id?'on':''}`} onClick={()=>{snd.click();setType(t.id);}}>{t.l} <span style={{color:'var(--mut)',fontSize:10}}>√ó{t.m}</span></button>)}</div>
    <BetInput value={bet} onChange={setBet} balance={balance}/>
    <button className="btn btn-gold" onClick={go} disabled={spin||bet<50||bet>balance}>{spin?'‚è≥ –ö–†–£–¢–ò–¢–°–Ø...':'üé° –ö–†–£–¢–ò–¢–¨'}</button>
    {result&&<div className={`res ${result.win>0?'rw':'rl'}`}><div style={{fontSize:16,marginBottom:5}}>–í—ã–ø–∞–ª–æ: <b style={{color:result.col==='red'?'var(--ruby)':result.col==='green'?'var(--em2)':'var(--txt)'}}>{result.num}</b></div><div className="rbig">{result.win>0?`+${result.win.toLocaleString()}`:result.profit.toLocaleString()} ‚òÖ</div></div>}
  </div>;
}

const KP={
  1:{1:3},
  2:{1:1,2:9},
  3:{1:1,2:2,3:22},
  4:{2:2,3:5,4:75},
  5:{2:1,3:3,4:15,5:500},
  6:{3:2,4:6,5:70,6:1000},
  7:{3:1,4:5,5:25,6:250,7:3000},
  8:{4:2,5:10,6:75,7:700,8:7500},
  9:{4:2,5:6,6:40,7:280,8:3000,9:18000},
  10:{4:1,5:3,6:22,7:150,8:1200,9:6000,10:80000},
};
function KenoGame({balance,setBalance}){
  const [bet,setBet]=useState(50);
  const [sel,setSel]=useState(new Set());
  const [drawn,setDrawn]=useState(new Set());
  const [hits,setHits]=useState(new Set());
  const [result,setResult]=useState(null);
  const [busy,setBusy]=useState(false);
  function tog(n){if(busy)return;snd.click();setSel(s=>{const ns=new Set(s);ns.has(n)?ns.delete(n):ns.size<10&&ns.add(n);return ns;});setDrawn(new Set());setHits(new Set());setResult(null);}
  function auto(){const ns=new Set();while(ns.size<10)ns.add(~~(Math.random()*80)+1);setSel(ns);setDrawn(new Set());setHits(new Set());setResult(null);}
  function play(){
    if(!sel.size||bet<50||bet>balance||busy)return;snd.i();setBusy(true);setResult(null);setBalance(b=>b-bet);
    const dr=new Set();while(dr.size<20)dr.add(~~(Math.random()*80)+1);
    const ht=new Set([...sel].filter(n=>dr.has(n)));const m=KP[sel.size]?.[ht.size]||0;const win=Math.floor(bet*m);
    if(win>0){setBalance(b=>b+win);setTimeout(()=>{snd.win();if(win>bet*10)snd.jackpot();},500);}else setTimeout(()=>snd.lose(),1000);
    const arr=[...dr];let i=0;
    const iv=setInterval(()=>{snd.tick();setDrawn(d=>new Set([...d,arr[i]]));if(ht.has(arr[i]))setHits(h=>new Set([...h,arr[i]]));i++;if(i>=arr.length){clearInterval(iv);setResult({win,profit:win-bet,hits:ht.size,spot:sel.size,m});setBusy(false);if(win>0)burst(true);api('play',{game:'keno',bet,spot:sel.size,hits:ht.size,win});}},60);
  }
  return <div>
    <div className="ksts">
      <div><div className="ksv">{sel.size}<span style={{color:'var(--mut)',fontSize:11}}>/10</span></div><div className="ksl">–í—ã–±—Ä–∞–Ω–æ</div></div>
      <div><div className="ksv">{drawn.size}<span style={{color:'var(--mut)',fontSize:11}}>/20</span></div><div className="ksl">–í—ã–ø–∞–ª–æ</div></div>
      <div><div className="ksv" style={{color:'var(--em2)'}}>{hits.size}</div><div className="ksl">–°–æ–≤–ø–∞–ª–æ</div></div>
    </div>
    <div className="kg">{Array.from({length:80},(_,i)=>i+1).map(n=>{const iS=sel.has(n),iH=hits.has(n),iD=drawn.has(n)&&!iH;return <div key={n} className={`kn ${iS&&!iD&&!iH?'sel':''} ${iD?'drw':''} ${iH?'hit':''}`} onClick={()=>tog(n)}>{n}</div>;})}</div>
    <BetInput value={bet} onChange={setBet} balance={balance}/>
    <div className="g2" style={{marginBottom:8}}><button className="btn btn-ghost" onClick={()=>{setSel(new Set());setDrawn(new Set());setHits(new Set());setResult(null);}}>–û–ß–ò–°–¢–ò–¢–¨</button><button className="btn btn-ghost" onClick={auto}>–ê–í–¢–û</button></div>
    <button className="btn btn-gold" onClick={play} disabled={busy||!sel.size||bet<50||bet>balance}>{busy?'‚è≥ –†–û–ó–´–ì–†–´–®...':'üé∞ –ò–ì–†–ê–¢–¨'}</button>
    {result&&<div className={`res ${result.win>0?'rw':'rl'}`}><div className="rbig">{result.win>0?`+${result.win.toLocaleString()}`:result.profit.toLocaleString()} ‚òÖ</div><div className="rsub">{result.hits}/{result.spot} –°–û–í–ü–ê–î–ï–ù–ò–ô {result.m>0?`√ó ${result.m}`:''}</div></div>}
  </div>;
}

// ================================================================
// –ì–õ–ê–í–ù–û–ï –ü–†–ò–õ–û–ñ–ï–ù–ò–ï
// ================================================================
const GAME_TABS=[{id:'keno',l:'üé∞ KENO'},{id:'crash',l:'üöÄ –ö–†–ê–®'},{id:'slots',l:'üé∞ –°–õ–û–¢–´'},{id:'bj',l:'üÉè –ë–ñ'},{id:'rlt',l:'üé° –†–¢–ö'}];
const BOT_TABS=[{id:'play',l:'üéÆ'},{id:'bonus',l:'üéÅ'},{id:'topup',l:'üí≥'},{id:'withdraw',l:'üí∞'},{id:'history',l:'üìú'},{id:'top',l:'üèÜ'},{id:'ref',l:'üë•'},{id:'profile',l:'üëë'}];
const TITLES={play:'–ò–≥—Ä—ã',bonus:'–ë–æ–Ω—É—Å –¥–Ω—è',topup:'–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ',withdraw:'–í—ã–≤–æ–¥',history:'–ò—Å—Ç–æ—Ä–∏—è',top:'–¢–û–ü-10',ref:'–†–µ—Ñ–µ—Ä–∞–ª–∫–∞',profile:'–ü—Ä–æ—Ñ–∏–ª—å'};

function App(){
  const [reg,setReg]=useState(null);
  const [profile,setProfile]=useState(null);
  const [balance,setBalance]=useState(500);
  const [tab,setTab]=useState('play');
  const [gt,setGt]=useState('keno');

  useEffect(()=>{
    tg?.ready();tg?.expand();
    tg?.setHeaderColor?.('#050508');
    tg?.setBackgroundColor?.('#050508');
    initBg();
    api('profile',{},true).then(r=>{
      if(r.ok&&r.data){setProfile(r.data);setBalance(r.data.balance||500);setReg(true);}
      else setReg(false);
    });
  },[]);

  function onReg(d){
    setProfile({username:d.username,vip:1,total_bet:0,total_win:0,wins:0,games:0});
    setBalance(d.balance||500);  // —Å—Ç–∞—Ä—Ç–æ–≤—ã–π –±–∞–ª–∞–Ω—Å 500
    setReg(true);
    showToast('üéâ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, '+d.username+'!');
  }
  async function refresh(){
    const r=await api('profile');
    if(r.ok&&r.data){setProfile(r.data);setBalance(r.data.balance);}
    showToast('‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–æ');
  }

  if(reg===null)return(
    <div style={{display:'flex',alignItems:'center',justifyContent:'center',height:'100vh',flexDirection:'column',gap:12,background:'var(--obs)'}}>
      <div style={{fontFamily:"'Cinzel',serif",fontSize:16,fontWeight:900,background:'linear-gradient(135deg,#8B6914,#F5D060)',WebkitBackgroundClip:'text',WebkitTextFillColor:'transparent',letterSpacing:3}}>ROYAL KENO KZ</div>
      <div className="spinner" style={{width:28,height:28,borderWidth:3}}/>
    </div>
  );

  if(!reg)return(
    <div className="app">
      <div className="hdr"><div className="logo">ROYAL KENO KZ</div></div>
      <div className="scr"><Registration onDone={onReg}/></div>
    </div>
  );

  return(
    <div className="app">
      <div className="hdr">
        <div style={{display:'flex',alignItems:'center',gap:8}}>
          {tab!=='play'&&<button style={{background:'none',border:'none',color:'var(--gold)',fontSize:20,cursor:'pointer',lineHeight:1}} onClick={()=>setTab('play')}>‚Äπ</button>}
          <div className="logo">{tab==='play'?'ROYAL KENO KZ':TITLES[tab]}</div>
        </div>
        <div className="bal-pill" onClick={()=>setTab('profile')}>
          <span style={{fontSize:13}}>‚òÖ</span>
          <span className="amt">{balance.toLocaleString()}</span>
        </div>
      </div>

      {tab==='play'&&<div className="subnav">
        {GAME_TABS.map(t=><button key={t.id} className={`snv ${gt===t.id?'on':''}`} onClick={()=>{snd.click();setGt(t.id);}}>{t.l}</button>)}
      </div>}

      <div className="scr">
        {tab==='play'&&<>
          {gt==='keno'  &&<KenoGame     balance={balance} setBalance={setBalance}/>}
          {gt==='crash' &&<CrashGame    balance={balance} setBalance={setBalance}/>}
          {gt==='slots' &&<SlotsGame    balance={balance} setBalance={setBalance}/>}
          {gt==='bj'    &&<BJGame       balance={balance} setBalance={setBalance}/>}
          {gt==='rlt'   &&<RouletteGame balance={balance} setBalance={setBalance}/>}
        </>}
        {tab==='bonus'   &&<BonusPage    balance={balance} setBalance={setBalance} vip={profile?.vip||1}/>}
        {tab==='topup'   &&<TopupPage    balance={balance} setBalance={setBalance}/>}
        {tab==='withdraw'&&<WithdrawPage balance={balance} setBalance={setBalance}/>}
        {tab==='history' &&<HistoryPage/>}
        {tab==='top'     &&<TopPage/>}
        {tab==='ref'     &&<RefPage userId={tgUser?.id||0}/>}
        {tab==='profile' &&<ProfilePage profile={profile||{}} balance={balance} onRefresh={refresh}/>}
      </div>

      <div className="bnav">
        {BOT_TABS.map(t=>(
          <button key={t.id} className="bni" onClick={()=>{snd.click();setTab(t.id);}}>
            <span>{t.l}</span>
            <span className="dot" style={{background:tab===t.id?'var(--gold)':'transparent'}}/>
          </button>
        ))}
      </div>
    </div>
  );
}

ReactDOM.render(<App/>,document.getElementById('root'));
</script>
</body>
</html>
